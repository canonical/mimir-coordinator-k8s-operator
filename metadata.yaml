name: mimir-coordinator-k8s
assumes:
  - k8s-api

docs: https://discourse.charmhub.io/t/mimir-coordinator-index/10531

summary: Mimir coordinator

description: |
    Mimir coordinator.

containers:
  nginx:
    resource: nginx-image

storage:
  data:
    type: filesystem

resources:
  nginx-image:
    type: oci-image
    description: OCI image for nginx
    upstream-source: ubuntu/nginx:1.18-22.04_beta
#  agent-image:
#    type: oci-image
#    upstream-source: ghcr.io/canonical/grafana-agent:latest
#    description: OCI image for Grafana Agent

requires:
  s3:
    interface: object-storage
    limit: 1
    description: |
      The coordinator obtains storage information on behalf of the workers and forwards all workers
      the storage details over mimir-worker. Limited to 1 to ensure only one storage backend will
      be connected to Mimir. Currently supports [Minio](https://charmhub.io/minio).

  send-remote-write:
    interface: prometheus_remote_write
    description: |
      Forward workers' metrics and rules to the external prometheus
      (the coordinator, not the worker, owns all rule files).
      Obtain rule files to later send them to the mimir rules over another relation.

  logging-consumer:
    interface: loki_push_api
    description: |
      Forward workers' built-in logging rules to the external Loki
      (the coordinator, not the worker, owns all rule files).
      Obtain rules and Loki's API endpoint to later send them to the mimir ruler over another
      relation.

  ingress:
    interface: ingress
    limit: 1
    description: |
      Ingress-per-app, to load-balance across multiple units of the coordinator.

provides:
  mimir-cluster:
    interface: mimir_cluster
    description: |
      The coordinator sends the Mimir configuration to the workers, obtaining
      the roles they are configured to take on and their addressing information.

  grafana-dashboards-provider:
    interface: grafana_dashboard
    description: |
      Forward workers' built-in dashboards to grafana
      (the coordinator, not the worker, owns all dashboards).

  tracing:
    interface: tracing
    description: |
      Send traces to tempo.
